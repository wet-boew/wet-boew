/*!
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * www.tbs.gc.ca/ws-nw/wet-boew/terms / www.sct.gc.ca/ws-nw/wet-boew/conditions
 */
(function(c){var a=window.pe||{fn:{}},b={type:"polyfill",depends:["calendar","xregexp"],_exec:function(h){var q,v,p=a.fn.calendar,n,m,g,y=new Date(),e,w="YYYY-MM-DD",o,j,x,r,u,k,i,z=y.getMonth(),d,t,s,l=y.getFullYear(),f;h.addClass("picker-field");g=function(A,D){var B=f.find("label[for='"+A+"']").text(),C=c('<a id="'+D+'-toggle" class="picker-toggle-hidden" href="javascript:;"><img src="'+pe.add.liblocation+'images/datepicker/icon.png" alt="'+pe.dic.get("%datepicker-show")+B+'"/></a>');C.on("click",function(){s(A,D)});h.after(C);n.slideUp(0)};q=function(E,G,F,I,D,B,H){D=p.getDateFromISOString(D);B=p.getDateFromISOString(B);var C=(G===D.getFullYear()&&F===D.getMonth()),A=(G===B.getFullYear()&&F===B.getMonth());I.each(function(J,M){if((!C&&!A)||(C===true&&J>=D.getDate())||(A===true&&J<=B.getDate())){var N=c(M).children("div"),L=c('<a href="javascript:;"></a>'),K=N.parent();K.empty();L.append(N.html());L.appendTo(K);L.on("keydown",function(Q){var O=c(this).closest(".cal-container"),P=O.attr("id");if(!(Q.ctrlKey||Q.altKey||Q.metaKey)){switch(Q.keyCode){case 27:s(E,E+"-picker");return false;case 32:c(this).trigger("click");return false;case 33:if(Q.shiftKey){d(P,G,F,D,B,new Date(G-1,F,J+1))}else{d(P,G,F,D,B,new Date(G,F-1,J+1))}return false;case 34:if(Q.shiftKey){d(P,G,F,D,B,new Date(G+1,F,J+1))}else{d(P,G,F,D,B,new Date(G,F+1,J+1))}return false;case 35:pe.focus(c(this).closest("ol").children("li").children("a").last());return false;case 36:pe.focus(c(this).closest("ol").children("li").children("a").first());return false;case 37:d(P,G,F,D,B,new Date(G,F,J));return false;case 38:d(P,G,F,D,B,new Date(G,F,J-6));return false;case 39:d(P,G,F,D,B,new Date(G,F,J+2));return false;case 40:d(P,G,F,D,B,new Date(G,F,J+8));return false}}else{if(Q.ctrlKey&&!(Q.altKey||Q.metaKey)){switch(Q.keyCode){case 35:d(P,G,F,D,B,new Date(G,11,31));return false;case 36:d(P,G,F,D,B,new Date(G,0,1));return false}}}});L.bind("click",{fieldid:E,year:G,month:F,day:J+1,days:I,format:H},function(O){v(O.data.fieldid,O.data.year,O.data.month+1,O.data.day,O.data.format);t(O.data.fieldid,O.data.year,O.data.month,O.data.days,O.data.format);s(O.data.fieldid,O.data.fieldid+"-picker")})}})};d=function(A,C,E,D,F,B){if(B.getTime()<D.getTime()){B=D;B.setDate(B.getDate()+1)}else{if(B.getTime()>F.getTime()){B=F;B.setDate(B.getDate()+1)}}if(B.getMonth()!==E||B.getFullYear()!==C){p.create(A,B.getFullYear(),B.getMonth(),true,p.getISOStringFromDate(D),p.getISOStringFromDate(F))}pe.focus(c("#"+A).find(".cal-day-list").children("li:eq("+(B.getDate()-1)+")").children("a"))};t=function(C,G,E,J,I){var F,A,B,H;c(J).removeClass("datepicker-selected");c(J).find(".datepicker-selected-text").detach();I=I.replace("DD","(?<a> [0-9]{2})");I=I.replace("D","(?<a> [0-9] )");I=I.replace("MM","(?<b> [0-9]{2})");I=I.replace("M","(?<b> [0-9])");I=I.replace("YYYY","(?<c> [0-9]{4})");I=I.replace("YY","(?<c /> [0-9]{2})");F="^"+I+"$";A=c("#"+C).attr("value");H=new XRegExp(F,"x");try{if(A!==""){B=c.parseJSON(A.replace(H,'{"year":"${c}", "month":"${b}", "day":"${a}"}'));if(B.year===G&&B.month===E+1){c(J[B.day-1]).addClass("datepicker-selected");c(J[B.day-1]).children("a").append('<span class="wb-invisible datepicker-selected-text"> ['+pe.dic.get("%datepicker-selected")+"]</span>")}}}catch(D){}};v=function(A,C,E,B,D){f.find("#"+A).attr("value",o(C,E,B,D))};s=function(B,C){var A=f.find("#"+C+"-toggle");A.toggleClass("picker-toggle-hidden picker-toggle-visible");n.unbind("focusout.calendar");n.unbind("focusin.calendar");if(A.hasClass("picker-toggle-visible")){x(B);n.find("a").attr("tabindex",0);n.slideDown("fast",function(){u(c(this))});n.attr("aria-hidden","false");A.children("a").children("span").text(pe.dic.get("%datepicker-hide"));if(n.find(".cal-prevmonth a").length!==0){pe.focus(n.find(".cal-prevmonth a"))}else{if(n.find(".cal-nextmonth a").length!==0){pe.focus(n.find(".cal-nextmonth a"))}else{pe.focus(n.find(".cal-goto a"))}}}else{j(c("#"+B));pe.focus(f.find("#"+B))}};x=function(A){c(".picker-field").each(function(){if(c(this).attr("id")!==A){j(c(this))}})};j=function(F){var B,E,C,A,D;B=F.attr("id");E=B+"-picker";C=c("#"+E);A=c("#"+E+"-toggle");D=c("label[for='"+B+"']").text();C.find("a").attr("tabindex","-1");C.slideUp("fast",function(){u(c(this))});C.attr("aria-hidden","true");p.hideGoToForm(E);A.children("a").children("span").text(pe.dic.get("%datepicker-show")+D);A.removeClass("picker-toggle-visible");A.addClass("picker-toggle-hidden")};u=function(A){var B=c("#wb-main-in"),C;if(pe.ie===7){C=A.height()+A.offset().top-B.offset().top+50;if(B.height()>=C){B.css("min-height","")}else{if(B.height()<C){B.css("min-height",C)}}}else{if(pe.ie>0&&pe.ie<7){C=A.height()+A.offset().top-B.offset().top+50;if(B.height()>=C){B.css("height","")}else{if(B.height()<C){B.css("height",C)}}}}};o=function(C,E,B,D){var A=D;A=A.replace("DD",p.strPad(B,2,"0"));A=A.replace("D",B);A=A.replace("MM",p.strPad(E,2,"0"));A=A.replace("M",E);A=A.replace("YYYY",C);A=A.replace("YY",C.toString().substr(2,2));return A};if(h.attr("id")!==undefined){r=h.attr("id");if(h.attr("data-min-date")!==undefined){i=h.attr("data-min-date")}else{i="1800-01-01"}if(h.attr("data-max-date")!==undefined){k=h.attr("data-max-date")}else{k="2100-01-01"}r=h.attr("id");e=h;f=h.parent();m=r+"-picker";n=c('<div id="'+m+'" class="picker-overlay" role="dialog" aria-controls="'+r+'" aria-labelledby="'+m+'-toggle"></div>');n.on("keyup",function(A){if(A.keyCode===27){x();pe.focus(h.parent().find("#"+r+"-picker-toggle"))}});e.parent().after(n);n.on("calendarDisplayed",function(C,A,B,D){q(r,A,B,D,i,k,w);t(r,A,B,D,w);c(this).find("a, select").on("blur",function(){window.setTimeout(function(){if(n.find(":focus").length===0){j(c("#"+n.attr("id").slice(0,-7)))}},1000)})});p.create(m,l,z,true,i,k);g(r,m);n.find("a").attr("tabindex","-1")}}};c.fn.datepicker=function(){c(this).each(function(){pe._execute(b,c(this))})};window.pe=a;c('[type="date"]').datepicker();return a}(jQuery));