/*! http://keith-wood.name/bookmark.html
	Sharing bookmarks for jQuery v1.4.0.
	Written by Keith Wood (kbwood{at}iinet.com.au) March 2008.
	Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
	MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
	Please attribute the author if you use it. */
(function(c){var d="bookmark";function b(){this._defaults={url:"",sourceTag:"",title:"",description:"",sites:[],iconsStyle:"bookmark_icons",icons:"bookmarks.png",iconSize:16,iconCols:16,target:"_blank",compact:true,hint:"Send to {s}",popup:false,popupText:"Bookmark this site...",addFavorite:false,favoriteText:"Favorite",favoriteIcon:0,addEmail:false,emailText:"E-mail",emailIcon:1,emailSubject:"Interesting page",emailBody:"I thought you might find this page interesting:\n{t} ({u})",manualBookmark:"Please close this dialog and\npress Ctrl-D to bookmark this page.",addShowAll:false,showAllText:"Show all ({n})",showAllIcon:2,showAllTitle:"All bookmarking sites",onSelect:null,addAnalytics:false,analyticsName:"/share/{r}/{s}"};this._sites={aol:{display:"myAOL",icon:3,lang:"en",category:"bookmark",url:"http://favorites.my.aol.com/ffclient/AddBookmark?url={u}&amp;title={t}"},bitly:{display:"bit.ly",icon:4,lang:"en",category:"tools",url:"http://bit.ly/?url={u}"},blogger:{display:"Blogger",icon:5,lang:"en",category:"blog",url:"http://www.blogger.com/blog_this.pyra?t=&amp;u={u}&amp;n={t}"},delicious:{display:"del.icio.us",icon:6,lang:"en",category:"bookmark",url:"http://del.icio.us/post?url={u}&amp;title={t}"},digg:{display:"Digg",icon:7,lang:"en",category:"news",url:"http://digg.com/submit?phase=2&amp;url={u}&amp;title={t}"},diigo:{display:"Diigo",icon:8,lang:"en",category:"social",url:"http://www.diigo.com/post?url={u}&amp;title={t}"},dzone:{display:"DZone",icon:9,lang:"en",category:"bookmark",url:"http://www.dzone.com/links/add.html?url={u}&amp;title={t}"},facebook:{display:"Facebook",icon:10,lang:"en",category:"social",url:"http://www.facebook.com/sharer.php?u={u}&amp;t={t}"},fark:{display:"Fark",icon:11,lang:"en",category:"news",url:"http://cgi.fark.com/cgi/fark/submit.pl?new_url={u}&amp;new_comment={t}"},google:{display:"Google",icon:12,lang:"en",category:"bookmark",url:"http://www.google.com/bookmarks/mark?op=edit&amp;bkmk={u}&amp;title={t}"},googlereader:{display:"Google Reader",icon:13,lang:"en",category:"tools",url:"http://www.google.com/reader/link?url={u}&amp;title={t}&amp;srcTitle={u}"},hotmail:{display:"Hotmail",icon:14,lang:"en",category:"mail",url:"http://www.hotmail.msn.com/secure/start?action=compose&amp;to=&amp;body={u}&amp;subject={t}"},linkedin:{display:"LinkedIn",icon:15,lang:"en",category:"social",url:"http://www.linkedin.com/shareArticle?mini=true&amp;url={u}&amp;title={t}&amp;ro=false&amp;summary={d}&amp;source="},mixx:{display:"Mixx",icon:16,lang:"en",category:"news",url:"http://www.mixx.com/submit/story?page_url={u}&amp;title={t}"},multiply:{display:"Multiply",icon:17,lang:"en",category:"social",url:"http://multiply.com/gus/journal/compose/addthis?body=&amp;url={u}&amp;subject={t}"},myspace:{display:"MySpace",icon:18,lang:"en",category:"social",url:"http://www.myspace.com/Modules/PostTo/Pages/?u={u}&amp;t={t}"},netvibes:{display:"Netvibes",icon:19,lang:"en",category:"news",url:"http://www.netvibes.com/share?url={u}&amp;title={t}"},newsvine:{display:"Newsvine",icon:20,lang:"en",category:"news",url:"http://www.newsvine.com/_wine/save?u={u}&amp;h={t}"},reddit:{display:"reddit",icon:21,lang:"en",category:"news",url:"http://reddit.com/submit?url={u}&amp;title={t}"},stumbleupon:{display:"StumbleUpon",icon:22,lang:"en",category:"bookmark",url:"http://www.stumbleupon.com/submit?url={u}&amp;title={t}"},technorati:{display:"Technorati",icon:23,lang:"en",category:"news",url:"http://www.technorati.com/faves?add={u}"},tipd:{display:"Tip'd",icon:24,lang:"en",category:"news",url:"http://tipd.com/submit.php?url={u}"},tumblr:{display:"tumblr",icon:25,lang:"en",category:"blog",url:"http://www.tumblr.com/share?v=3&amp;u={u}&amp;t={t}"},twitter:{display:"twitter",icon:26,lang:"en",category:"blog",url:"http://twitter.com/home?status={t}%20{u}"},windows:{display:"Windows Live",icon:27,lang:"en",category:"bookmark",url:"https://favorites.live.com/quickadd.aspx?marklet=1&amp;mkt=en-us&amp;url={u}&amp;title={t}"},wishlist:{display:"Amazon WishList",icon:28,lang:"en",category:"shopping",url:"http://www.amazon.com/wishlist/add?u={u}&amp;t={t}"},yahoo:{display:"Yahoo Bookmarks",icon:29,lang:"en",category:"bookmark",url:"http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&amp;u={u}&amp;t={t}"},yahoobuzz:{display:"Yahoo Buzz",icon:30,lang:"en",category:"bookmark",url:"http://buzz.yahoo.com/submit?submitUrl={u}&amp;submitHeadline={t}"}};this.commonSites=[];for(var e in this._sites){this.commonSites.push(e)}}c.extend(b.prototype,{markerClassName:"hasBookmark",setDefaults:function(e){a(this._defaults,e||{});return this},addSite:function(j,h,f,i,g,e){this._sites[j]={display:h,icon:f,lang:i,category:g,url:e};return this},getSites:function(){return this._sites},_attachBookmark:function(f,e){f=c(f);if(f.hasClass(this.markerClassName)){return}f.addClass(this.markerClassName);this._updateBookmark(f,e)},_changeBookmark:function(h,f,g){h=c(h);if(!h.hasClass(this.markerClassName)){return}if(typeof f==="string"){var e=f;f={};f[e]=g}this._updateBookmark(h,f)},_updateBookmark:function(l,h){var k=c.data(l[0],d)||c.extend({},this._defaults);h=a(k,h||{});c.data(l[0],d,h);var o=h.sites;if(o.length===0){c.each(c.bookmark._sites,function(n){o.push(n)});o.sort()}else{c.each(o,function(n,q){var r=q.match(/lang:(.*)/);if(r){c.each(c.bookmark._sites,function(t,s){if(s.lang===r[1]&&c.inArray(t,o)===-1){o.push(t)}})}var p=q.match(/category:(.*)/);if(p){c.each(c.bookmark._sites,function(t,s){if(s.category===p[1]&&c.inArray(t,o)===-1){o.push(t)}})}})}l.empty();var f=l;if(h.popup){l.append('<a href="#" class="bookmark_popup_text">'+h.popupText+"</a>");f=c('<div class="bookmark_popup"></div>').appendTo(l)}var e=c.bookmark._getSiteDetails(h);var m=c('<ul class="bookmark_list'+(h.compact?" bookmark_compact":"")+'"></ul>').appendTo(f);if(h.addFavorite){c.bookmark._addOneSite(h,m,h.favoriteText,h.favoriteIcon,"#",function(){c.bookmark._addFavourite(e.url.replace(/'/g,"\\'"),e.title.replace(/'/g,"\\'"));return false})}if(h.addEmail){c.bookmark._addOneSite(h,m,h.emailText,h.emailIcon,"mailto:?subject="+encodeURIComponent(h.emailSubject)+"&amp;body="+encodeURIComponent(h.emailBody.replace(/\{u\}/,e.url).replace(/\{t\}/,e.title).replace(/\{d\}/,e.desc)))}c.bookmark._addSelectedSites(o,e,h,m);if(h.addShowAll){var j=0;for(var g in c.bookmark._sites){j++}var i=h.showAllText.replace(/\{n\}/,j);c.bookmark._addOneSite(h,m,i,h.showAllIcon,"#",function(){c.bookmark._showAll(this,h);return false},i)}if(h.popup){l.find(".bookmark_popup_text").click(function(){var n=c(this).parent();var p=n.offset();n.find(".bookmark_popup").css("left",p.left).css("top",p.top+n.outerHeight()).toggle();return false});c(document).click(function(){l.find(".bookmark_popup").hide()})}},_addSelectedSites:function(h,e,f,g){c.each(h,function(j,k){var i=c.bookmark._sites[k];if(i){c.bookmark._addOneSite(f,g,i.display,i.icon,(f.onSelect?"#":i.url.replace(/\{u\}/,e.url2+(e.sourceTag?e.sourceTag+k:"")).replace(/\{t\}/,e.title2).replace(/\{d\}/,e.desc2)),function(){if(f.addAnalytics&&window.pageTracker){window.pageTracker._trackPageview(f.analyticsName.replace(/\{s\}/,k).replace(/\{n\}/,i.display).replace(/\{u\}/,e.url).replace(/\{r\}/,e.relUrl).replace(/\{t\}/,e.title))}c("#bookmark_all").remove();c(document).unbind("click.bookmark");if(f.onSelect){c.bookmark._selected(c(this).closest("."+c.bookmark.markerClassName)[0],k);return false}return true})}})},_addOneSite:function(f,j,k,l,e,n,h){var g=f.hint||"{s}";var i='<li><a href="'+e+'"'+(f.target?' target="'+f.target+'"':"")+">";if(l!==null){var m=h||g.replace(/\{s\}/,k);if(typeof l==="number"){i+='<span title="'+m+'" '+(f.iconsStyle?'class="'+f.iconsStyle+'" ':"")+'style="'+(f.iconsStyle?"background-position: ":"background: transparent url("+f.icons+") no-repeat ")+"-"+((l%f.iconCols)*f.iconSize)+"px -"+(Math.floor(l/f.iconCols)*f.iconSize)+'px;"></span>'}else{i+='<img src="'+l+'" alt="'+m+'" title="'+m+'"/>'}i+=(f.compact?"":"&#xa0;")}i+=(f.compact?"":k)+"</a></li>";i=c(i).appendTo(j);if(n){i.find("a").click(n)}},_destroyBookmark:function(e){e=c(e);if(!e.hasClass(this.markerClassName)){return}e.removeClass(this.markerClassName).empty();c.removeData(e[0],d)},_selected:function(i,h){var g=c.data(i,d);var e=c.bookmark._sites[h];var f=c.bookmark._getSiteDetails(g);g.onSelect.apply(i,[h,e.display,e.url.replace(/&amp;/g,"&").replace(/\{u\}/,f.url2+(f.sourceTag?f.sourceTag+h:"")).replace(/\{t\}/,f.title2).replace(/\{d\}/,f.desc2)])},_addFavourite:function(e,f){if(typeof window.external.AddFavorite!=="undefined"){window.external.AddFavorite(e,f)}else{alert(this._defaults.manualBookmark)}},_showAll:function(i,h){var k=[];c.each(c.bookmark._sites,function(l){k.push(l)});k.sort();var e=c.bookmark._getSiteDetails(h);var j=c('<ul class="bookmark_list"></ul>');var g=h.compact;h.compact=false;c.bookmark._addSelectedSites(k,e,h,j);h.compact=g;var f=c('<div id="bookmark_all"><p>'+h.showAllTitle+"</p></div>").append(j).appendTo("body");f.css({left:(c(window).width()-f.width())/2,top:(c(window).height()-f.height())/2}).show();c(document).bind("click.bookmark",function(l){if(c(l.target).closest(i).length===0&&c(l.target).closest("#bookmark_all").length===0){c("#bookmark_all").remove();c(document).unbind("click.bookmark")}})},_getSiteDetails:function(g){var f=g.url||window.location.href;var i=g.title||document.title||c("h1:first").text();var h=g.description||c('meta[name="description"]').attr("content")||"";var e=(!g.sourceTag?"":encodeURIComponent((f.indexOf("?")>-1?"&":"?")+g.sourceTag+"="));return{url:f,title:i,desc:h,relUrl:f.replace(/^.*\/\/[^\/]*\//,""),sourceTag:e,url2:encodeURIComponent(f),title2:encodeURIComponent(i),desc2:encodeURIComponent(h)}}});function a(g,f){c.extend(g,f);for(var e in f){if(f[e]===null){g[e]=null}}return g}c.fn.bookmark=function(f){var e=Array.prototype.slice.call(arguments,1);return this.each(function(){if(typeof f==="string"){if(!c.bookmark["_"+f+"Bookmark"]){throw"Unknown operation: "+f}c.bookmark["_"+f+"Bookmark"].apply(c.bookmark,[this].concat(e))}else{c.bookmark._attachBookmark(this,f||{})}})};c.bookmark=new b()})(jQuery);